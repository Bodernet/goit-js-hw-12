{"version":3,"file":"commonHelpers.js","sources":["../src/main.js"],"sourcesContent":["import SimpleLightbox from 'simplelightbox';\nimport 'simplelightbox/dist/simple-lightbox.min.css';\n\nimport iziToast from 'izitoast';\nimport 'izitoast/dist/css/iziToast.min.css';\n\nimport axios from 'axios';\n\naxios.defaults.baseURL = 'https://pixabay.com/api';\nconst API_KEY = '41936299-e1d4d29e6aed15564c1848147';\nconst hidden = 'is-hidden';\n\nconst simpleGallery = new SimpleLightbox('.gallery-item a', {\n  captionsData: 'alt',\n  captionDelay: 250,\n});\n\nconst refs = {\n  form: document.querySelector('.form'),\n  input: document.querySelector('.search-input'),\n  button: document.querySelector('.search-btn'),\n  loader: document.querySelector('.loader'),\n  gallery: document.querySelector('.gallery'),\n  loadMoreBtn: document.querySelector('.load-more-btn'),\n};\n\nlet query = '';\nlet page = 1;\nlet maxPage = 0;\n\nrefs.form.addEventListener(`submit`, onSearch);\n\nasync function onSearch(e) {\n  e.preventDefault();\n  refs.gallery.innerHTML = '';\n  page = 1;\n  refs.loadMoreBtn.classList.add(hidden);\n  query = refs.input.value.trim();\n\n  if (!query) {\n    createMessage('Please, enter search term!');\n    return;\n  }\n\n  if (!API_KEY.trim()) {\n    createMessage('API key is missing or invalid.');\n    return;\n  }\n\n  try {\n    showLoader(true);\n    const { hits, totalHits } = await getImages(query);\n    maxPage = Math.ceil(totalHits / 40);\n    createMarkup(hits);\n    simpleGallery.refresh();\n    refs.loadMoreBtn.removeEventListener('click', onLoadMoreBtn);\n    if (hits.length > 0) {\n      refs.loadMoreBtn.classList.remove(hidden);\n      refs.loadMoreBtn.addEventListener('click', onLoadMoreBtn);\n    } else {\n      refs.loadMoreBtn.classList.add(hidden);\n      createMessage(\n        `Sorry, there are no images matching your search query. Please, try again!`\n      );\n    }\n    refs.form.reset();\n  } catch (error) {\n    console.log(error);\n    createMessage('An error occurred. Please try again later.');\n  } finally {\n    showLoader(false);\n    if (page === maxPage) {\n      refs.loadMoreBtn.classList.add(hidden);\n      createMessage(\n        \"We're sorry, but you've reached the end of search results!\"\n      );\n    }\n  }\n}\n\nasync function onLoadMoreBtn() {\n  if (page > maxPage) {\n    refs.loadMoreBtn.classList.add(hidden);\n    return;\n  }\n  page += 1;\n  try {\n    showLoader(true);\n    refs.loadMoreBtn.classList.add(hidden);\n    const { hits } = await getImages(query, page);\n    createMarkup(hits);\n    simpleGallery.refresh();\n    showLoader(false);\n    scrollDown();\n    refs.loadMoreBtn.classList.remove(hidden);\n  } catch (error) {\n    console.log(error);\n    createMessage('An error occurred. Please try again later.');\n  } finally {\n    if (page === maxPage) {\n      refs.loadMoreBtn.classList.add(hidden);\n      createMessage(\n        \"We're sorry, but you've reached the end of search results!\"\n      );\n    }\n  }\n}\n\nasync function getImages(query, page = 1) {\n  showLoader(true);\n  const data = await axios.get('/', {\n    params: {\n      key: API_KEY,\n      q: query,\n      image_type: 'photo',\n      orientation: 'horizontal',\n      safesearch: true,\n      per_page: 40,\n      page,\n    },\n  });\n\n  return data.data;\n}\n\nfunction createMarkup(hits) {\n  const markup = hits\n    .map(\n      ({\n        webformatURL,\n        largeImageURL,\n        tags,\n        likes,\n        views,\n        comments,\n        downloads,\n      }) =>\n        `\n          <li class=\"gallery-item\">\n    <a class=\"gallery-link\" href=\"${largeImageURL}\">\n      <img\n        class=\"gallery-img\"\n        src=\"${webformatURL}\"\n        alt=\"${tags}\"\n      />\n      <p class=\"gallery-inf\">\n      Likes: <span class=\"img-stat\">${likes}</span> \n      Views: <span class=\"img-stat\">${views}</span> \n      Comments: <span class=\"img-stat\">${comments}</span> \n      Downloads: <span class=\"img-stat\">${downloads}</span></p>\n    </a>\n  </li>`\n    )\n    .join('');\n  refs.gallery.insertAdjacentHTML('beforeend', markup);\n}\n\nfunction createMessage(message) {\n  iziToast.show({\n    class: 'error-circul',\n    position: 'topRight',\n    icon: 'error-circul',\n    message: message,\n    maxWidth: '432',\n    messageColor: '#fff',\n    messageSize: '16px',\n    backgroundColor: '#EF4040',\n    close: false,\n    closeOnClick: true,\n  });\n}\nfunction scrollDown() {\n  const galleryLink = document.querySelector('.gallery-link');\n  if (galleryLink) {\n    const rect = galleryLink.getBoundingClientRect();\n    window.scrollBy({ top: rect.height * 2, left: 0, behavior: 'smooth' });\n  }\n}\n\nfunction showLoader(state = true) {\n  refs.loader.style.display = !state ? 'none' : 'inline-block';\n  refs.button.disabled = state;\n}\n"],"names":["axios","API_KEY","hidden","simpleGallery","SimpleLightbox","refs","query","page","maxPage","onSearch","createMessage","showLoader","hits","totalHits","getImages","createMarkup","onLoadMoreBtn","error","scrollDown","markup","webformatURL","largeImageURL","tags","likes","views","comments","downloads","message","iziToast","galleryLink","rect","state"],"mappings":"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"}